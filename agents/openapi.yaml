openapi: 3.1.0
info:
  title: startupShop Agent API
  version: 0.8.0
  description: Agent-navigable API for startup listings, offers, admin sessions, and operational checks.
servers:
  - url: http://localhost:3000
paths:
  /api/startups:
    get:
      summary: List startups
      parameters:
        - name: category
          in: query
          schema: { type: string }
        - name: stage
          in: query
          schema:
            type: string
            enum: [idea, mvp, early-revenue, growth, mature]
        - name: sort
          in: query
          schema:
            type: string
            enum: [score, mrr]
            default: score
      responses:
        '200':
          description: Startup list
  /api/startups/{id}:
    get:
      summary: Get startup by id
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Startup detail }
        '404': { description: Startup not found }
  /api/startups/{id}/validation:
    get:
      summary: Get startup validation status
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Validation status }
        '404': { description: Startup not found }
  /api/startups/{id}/metrics:
    get:
      summary: Get startup metrics
      description: Returns latest successful snapshot by default. Use refresh=true to force live fetch.
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
        - name: refresh
          in: query
          schema: { type: boolean }
      responses:
        '200': { description: Metrics payload }
        '404': { description: Startup not found or no metrics_url }
        '502': { description: Upstream metrics source failed }
  /api/internal/metrics/sync:
    post:
      summary: Trigger metrics sync for all startups with metrics_url
      parameters:
        - name: x-sync-token
          in: header
          required: true
          schema: { type: string }
      responses:
        '200': { description: Sync summary }
        '401': { description: Unauthorized }
  /api/offers:
    post:
      summary: Submit offer
      responses:
        '201': { description: Offer accepted }
        '400': { description: Invalid payload or unknown startup }
        '413': { description: Payload too large }
        '429': { description: Rate limit exceeded }
        '500': { description: Offer persistence failed }
  /api/admin/session:
    post:
      summary: Admin login (creates session cookie)
      responses:
        '200': { description: Session created }
        '400': { description: Invalid JSON }
        '401': { description: Invalid credentials }
    delete:
      summary: Admin logout (requires valid session + CSRF)
      parameters:
        - name: x-csrf-token
          in: header
          required: true
          schema: { type: string }
      responses:
        '200': { description: Session cleared }
        '401': { description: Unauthorized }
        '403': { description: Invalid CSRF token }
  /api/health:
    get:
      summary: Liveness check
      responses:
        '200': { description: Service is live }
  /api/ready:
    get:
      summary: Readiness check
      responses:
        '200':
          description: Service dependencies are ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ReadinessStatus'
        '503':
          description: Service dependencies are not ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ReadinessStatus'
components:
  schemas:
    ReadinessCheck:
      type: object
      required: [ok, detail]
      properties:
        ok: { type: boolean }
        detail: { type: string }
    ReadinessStatus:
      type: object
      required: [ready, checks, timestamp]
      properties:
        ready: { type: boolean }
        checks:
          type: object
          required: [db, redis, metrics_sync, admin_auth]
          properties:
            db: { $ref: '#/components/schemas/ReadinessCheck' }
            redis: { $ref: '#/components/schemas/ReadinessCheck' }
            metrics_sync: { $ref: '#/components/schemas/ReadinessCheck' }
            admin_auth: { $ref: '#/components/schemas/ReadinessCheck' }
        timestamp:
          type: string
          format: date-time
